# Проектная работа "Веб-ларек"

Используемый стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Описание проекта "Веб-ларек"
"Веб-ларек" - интернет-магазин. По сути есть главная страница с перечнем товаров и значком корзины и множество модальных окон, которые обеспечивают возможность посмотреть конкретный товар и возможность оформить по нему заказ.
Макет: https://www.figma.com/design/50YEgxY8IYDYj7UQu7yChb/Веб-ларёк?node-id=1-735&t=5o12C686f6mogjbA-0

## Архитектурный паттерн
В качестве паттерна для построения архитектуры приложения (интернет-магазина) выбран MVP (Model-View-Presenter) - паттерн.
MVP разделяет приложение на три основных компонента:
- Модель (Model) — представляет бизнес-логику приложения и данные.
- Представление (View) — отображает данные пользователю и обрабатывает пользовательский ввод.
- Презентер (Presenter) — является посредником между моделью и представлением. Модель и представление взаимодействуют только через презентер.

## Более детальное описание
На главной странице загружаются доступные товары.  
На главной странице отображается корзина с указанием количества товаров в ней.  
Пользователь может кликнуть по корзине, откроется корзина с данными (название, цена) по товарам, которые в ней находятся.  
Пользователь кликом открывает карточку товара для просмотра. Карточка товара содержит идентификатор товара, название товара, описание товара, изображение товара, категорию товара и цену.  
Товар можно добавить только один раз, т.е. в процессе попытки добавления товара в корзину необходимо учитывать его возможное наличие в корзине.  
После добавления всех товаров в корзину сумма по всем товарам суммируется. Также в корзине имеется возможность удалить любой товар.  
ОФОРМЛЕНИЕ ЗАКАЗА ТОВАРА  
ВСЕ, что используется при офорлении заказа (включая все, что должно быть заполнено в формах):  
- Перечень карточек товара (массив).  
- Общая сумма.  
- Тип оплаты.  
- Адрес доставки.  
- Телефон.  
- Email.  
  
Далее должны производиться проверка заполненных полей и выбранного способа оплаты (общая и каждая в отдельности); очистка всех полей и выставление базового способа оплаты.  
После этого происходит завершение оформления заказа. В окне успеха завершения заказа отображается сумма по заказу.  
API используется для:  
- получения с сервера данныех для КАРТОЧКИ ТОВАРА, списка карточек,  
- отправления данных по заказу (объект заказа).  

## БАЗОВЫЕ сущности

### Базовый класс API
Реализуем базовый класс Api доступа к серверу для последующего использования. При описании API указываем методы "GET" (для получения данных), "PUT" (для обновления данных), "POST" (для добавления данных), "DELETE" (для удаления данных).  

### Базовый класс EventEmitter
Брокер событий. Класс включает методы on (установить обработчик на событие), off (убрать обработчик с события), emit (инициировать событие с данными). Дополнительноые методы: onAll (слушать все события) и offAll (сбросить все обработчики).  

### Базовый класс Veiw
Реализуем базовый абстрактный класс View, который будет использоваться (наследоваться) в классах сущностей VEIW.
Конструктор класса:
```js
protected constructor(protected readonly container: HTMLElement, protected events: IEvents) {}
```
Методы: переключение класса, установка текстового содержимого, смена статуса блокировки, скрытие и показ элемента, установка изображения с альтернативным текстом, возвращение объекта контейнера.

### Базовый класс Model
Описываем базовый абстрактный класс Model, который будет использоваться (наследоваться) в классах сущностей MODEL.
Конструктор класса:
```js
constructor(data: Partial<T>, protected events: IEvents) {
	Object.assign(this, data);
}
```
Методы: запускаем событие, сообщаем об изменении в модели

## СВЯЗИ ИЗВНЕ
API  
Используем для:  
- получения с сервера данныех для КАРТОЧКИ ТОВАРА, списка карточек,  
- отправления данных по заказу (объект заказа).  
Прописываем методы.
```js 
interface IWebLarekAPI {
	getCardItem: (id: string) => Promise<ICard>; // метод получения информации по конкретной карточки
	getCardList: () => Promise<ICard[]>; // метод получения списка карточек
	postOrderCards: (order: IOrderAPI) => Promise<IOrderResult>; //метод отправки на сервер запроса по заказу
}
```
Где IOrderResult - интерфейс ответа на post запрос на оформление заказа.  

## MODEL, PRESENTER, VIEW
### MODEL
Содержит следующие глобальные сущности: КАРТОЧКА ТОВАРА, ЗАКАЗ, описание приложения (AppState)  
КАРТОЧКА ТОВАРА  
Тип, который описывает все категории товаров, представленные в макете интернет-магазина:  
```js 
type CardCategoryType = "софт-скил" | "кнопка" | "другое" | "хард-скил" | "дополнительное";  
```

Данные по карточке товара, которые мы базово получаем с сервера:  
```js 
interface IСardApi {  
    id: string; //идентификатор товара  
    description: string; //описание товара  
    image: string; //изображение товара  
    title: string; //название товара  
    category: CardCategoryType; //категория товара  
    price: number | null; //цена товара  
}  
```
Данные, связанные с корзиной:  
```js 
interface ICardBasket {  
    selected: boolean; //значение выбора  
    addToBasket(): void; //метод добавления в корзину  
    removeFromBasket(): void; //метод удаления из корзины  
    }  
```
Тогда в целом описание КАРТОЧКИ ТОВАРА должно выглядеть следующим образом:  
```js 
interface ICard extends IСardApi, ICardBasket {}  
```

Тип, который описывает все возможные варианты оплаты товаров:  
```js 
type IPaymentType = "card" | "cash";  
```
Заполняем две формы:  
```js 
interface IOrderDeliveryPaymentForm {  
	payment: PaymentType; //способ оплаты  
	address: string; // адрес доставки  
}  
  
interface IOrderContactsForm {  
    email: string; //email пользователя  
    phone: string; //телефон пользователя  
}  
```
Полная форма (включает 2 формы):  
```js 
interface IOrderCommonForm extends IOrderDeliveryPaymentForm, IOrderContactsForm {}  
```
Тогда итоговый интерфейс оформления заказа выглядит примерно так:  
```js 
interface IOderForm extends IOrderCommonForm {  
    items: ICard[]; //перечень карточек в корзине (беру из postman название значения)  
    validateOderForm(): void; //функция проверки корректности введенных пользователем данных  
    validateEmail(): void; //функция проверки корректности введенных пользователем данных - email  
    validatePhone(): void; //функция проверки корректности введенных пользователем данных - номера телефона  
    validatePayment(): void; //функция проверки корректности выбора способа оплаты - онлайн или при получении  
    validateAdress(): void;//функция проверки корректности введенных пользователем данных - адрес  
    clearOderForm(): void; //очистка формы  
    submitOder(): void; //завершение оформления  
}  
```
В случае ошибки:    
```js 
type OderFormErrors = Partial<Record<keyof IOderForm, string>>;  
```
Интерфейс для отправки данных на сервер:  
```js 
interface IOrderAPI extends IOderForm{
    items: string[]; // покупаемые товары
	total: number; // общая сумма заказа
}
```
Интерфейс для состояния приложения:  
```js 
interface IAppState {  
    cardList: ICard[]; //перечень карточек  
    selectCard: ICard; //карточка при открытии  
    order: IOderForm; //заказ  
    basket: ICard[]; //перечень карточек в корзине  
    isCardInBasket(): boolean;//метод для проверки наличия в корзине (вернуть значение, выбрана ли карточка (selected))  
    getCardInBasket(): number;//метод получить количество карточек в корзине  
    getCardIdInBasket(): number;//метод получить id карточек в корзине  
    getTotalPrice(): number;//метод отобразить сумму заказа по всем карточкам в корзине, меняется в зависимости от доб./удаления карточек  
    makeOrder(): void;//метод сдеалть заказ  
    clearBasket(): void;//метод очистить данные корзины после подтверждения оформления заказа  
}  
```
Описание одной карточки в корзине:  
```js 
type BasketItem = Pick<ICard, "id" | "title" | "price">  
```
После оформления заказа мы получаем данные с сервера для отображения на странице карточек, интерфейс:  
```js 
interface ICardList {  
    cardList: ICard[]; //перечень карточек  
}  
```
Базовый класс с описанием конструктора и методов для MODEL вынесен в базовые сущности (как абстрактный класс) и используется (наследуется) в классах сущностей.
Конструктор:
```js 
constructor(data: Partial<T>, protected events: IEvents) {
		Object.assign(this, data);
}
```
Partial<T> — это тип, который позволяет создать новый тип со всеми свойствами типа T, но с установленными необязательными свойствами.
  
Метод базового класса:
Метод emitChanges запускает событие. Сообщение об изменении в модели.
```js 
emitChanges(event: string, payload?: object)
```


### PRESENTER
В PRESENTER с использованием данных IWebLarekAPI и EventEmitter описываем события, сявзываем все воедино.

  
### VIEW
Содержит следующие сущности (в интерфейсах (типах) привязка к элементам HTML):  
- Главная страница (отображается список карточек товаров и значек корзина с количеством товаров). 
```js 
interface IMainPage {
	galery: HTMLElement[]; // список карточек
    counter: number; // счётчик товаров в корзине
    locked: boolean; //признак блокировки прокрутки
}
```
- Карточка товара (категория, название, описание, цена, картинка, кнопка).  
```js 
interface ICard {
    //...аналогично модели
	button?: string; // кнопка добавления в заказ
}
interface ICardClick {
	onClick(event: MouseEvent): void; // метод открытия по клику
}
```
- Модальное окно (контент, кнопка).  
```js 
interface IModalContent {
	content: HTMLElement;
}
```
- Корзина содержит 2 сущности: отображение самой корзины, включая общую сумму по товарам, и отображение позиции из перечня товаров в корзине (номер по порядку, название, цена, кнопка удалить (метод удаления)).
Описание интерфейсов (типов) для корзины:
```js 
interface IBasketView {
	items: HTMLElement[];
	total: number;
    valid: boolean;
}
interface IBasketCard {
	index: number; // номер по порядку в корзине
	title: string; // название товара
	price: number; // цена товара
	delete(): void; // метод удаления товара из корзины
}
```
- Формы для оформления заказа: 2 формы: способ оплаты, адрес, имя, телефон, базовая форма: кнопка отправки, отображение ошибок после проверки.  
Описание интерфейсов (типов):
```js 
interface IOrderDeliveryPaymentForm {  
	payment: PaymentType; //способ оплаты  
	address: string; // адрес доставки  
}  
  
interface IOrderContactsForm {  
    email: string; //email пользователя  
    phone: string; //телефон пользователя  
} 

interface IFormState {
	valid: boolean; // валидность формы
	errors: string[]; // ошибки в форме
}
```
- Успешное завершение заказа, содержит общую сумму заказа.  
Интерфейсы (типы):
```js 
interface ISuccessOder {
    total: number;  // общая сумма заказа
}
```
Базовый класс с описанием конструктора и методов для VIEW вынесен в базовые сущности (как абстрактный класс) и используется (наследуется) в классах сущностей.
Конструктор и ряд методов в базовом классе имеют модификатор protected, который означает, что конструктор и методы могут использоваться только внутри класса или у класса - наследника.
Конструктор имеет вид:
```js 
protected constructor(protected readonly container: HTMLElement, protected events: IEvents) {}
```
Методы базового класса:
```js
	//Переключить класс
	toggleClass(element: HTMLElement, className: string, force?: boolean)
	//Установить текстовое содержимое
	protected setText(element: HTMLElement, value: unknown)
	//Сменить статус блокировки
	setDisabled(element: HTMLElement, state: boolean)
	// Скрыть элемент
	protected setHidden(element: HTMLElement)
	// Показать элемент
	protected setVisible(element: HTMLElement)
	// Установить изображение с альтернативным текстом
	protected setImage(element: HTMLImageElement, src: string, alt?: string)
	//Вернуть корневой DOM-элемент
	render(data?: Partial<T>): HTMLElement
```
Для каждой сущности создается класс, который изначально наследует базовый класс для представления и описывает конкретную сущность (главную страницу, карточку, корзину и т.д. ...).  



